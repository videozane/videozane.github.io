<!DOCTYPE html>
<html>
<head>
    <title>Project 3: Image Warping and Mosaicing</title>
    <link rel="stylesheet" href="../stylesheet.css">
</head>
<body>

<script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
</script>
<script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<div class="header-card">
    <div class="header-left">
        <h1>Project 3: Image Warping and Mosaicing</h1>
    </div>
    <div class="header-right">
        <span class="tag">CS180</span>
        <span class="tag">Due Oct 8, 2025 at 11:59 PM</span>
        <span class="tag">Zane Danton</span>
    </div>
</div>

<div class="base_page">
    <h3>A.1: Shoot and digitize pictures</h1>
    <p>
        I took three sets of photos: a view from the Music Library, Wurster stairs, and Wurster Hall.
    </p>

    <p>
        For each set, I tried to maintain an overlap region, as well as rotate my camera solely about the actual camera to prevent shifts. 
    </p>

    <h4>Set 1: Music Library View</h4>
    <div class="item-row" style="align-self: center; justify-content: center;">
          <div class="image-col">
            <img src="./images/set1/L1.jpg" alt="Music Library 1">
          </div>
          <div class="image-col">
            <img src="./images/set1/L2.jpg" alt="Music Library 2">
          </div>
    </div>

    <h4>Set 2: Wurster Hall</h4>
    <div class="item-row" style="align-self: center; justify-content: center;">
          <div class="image-col">
            <img src="./images/set2/R1.jpg" alt="Wurster Hall 1">
          </div>
          <div class="image-col">
            <img src="./images/set2/R2.jpg" alt="Wurster Hall 2">
          </div>
    </div>

    <h4>Set 3: Wurster Stairs</h4>
    <div class="item-row" style="align-self: center; justify-content: center;">
          <div class="image-col">
            <img src="./images/set3/L1.jpg" alt="Wurster Stairs 1">
          </div>
          <div class="image-col">
            <img src="./images/set3/L2.jpg" alt="Wurster Stairs 2">
          </div>
    </div>
</div>

<br>

<div class="base_page">
  <h3>A.2: Implement computeH(im1_pts,im2_pts)</h3>
  <h4>Derive Point correspondence</h4>
  <p> 
    Begining with the homography equation from lecture, we have:
  </p>
  $$
  \begin{bmatrix} x'w \\ y'w \\ w \end{bmatrix} =
  \begin{bmatrix} h_{11} & h_{12} & h_{13} \\ h_{21} & h_{22} & h_{23} \\ h_{31} & h_{32} & h_{33} \end{bmatrix}
  \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}
  $$
  <p>$w$ is the homogenous scaling factor.
    If we multiply two right side matrices, we get the three equations:
  </p>
  $$
  \begin{align*}
      x'w &= h_{11}x + h_{12}y + h_{13} \\
      y'w &= h_{21}x + h_{22}y + h_{23} \\
      w &= h_{31}x + h_{32}y + h_{33}
  \end{align*}
  $$
  <p>
    We know from lecture that we can set $h_{33} = 1$ to reduce the number of unknowns from 9 to 8, since the homography is defined up to scale. This gives us:
  </p>
  $$
  w = h_{31}x + h_{32}y + 1
  $$
  <p>which we can substitue into the other equations to eliminate $w$:</p>

  \begin{align*}
      x'(h_{31}x + h_{32}y + 1) &= h_{11}x + h_{12}y + h_{13} \\
      y'(h_{31}x + h_{32}y + 1) &= h_{21}x + h_{22}y + h_{23}
  \end{align*}

  <p>
    If we isolate $x'$ and $y'$, we directly define the rows of matrix $A$ and vector $b$ for a point correspondence:
  </p>
  \begin{align*}
      h_{11}x + h_{12}y + h_{13} - h_{31}x x' - h_{32}y x' &= x' \\
      h_{21}x + h_{22}y + h_{23} - h_{31}x y' - h_{32}y y' &= y'
  \end{align*}
  <br>
  <h4>Creating the homography </h4>
  <p>
    The vector of our 8 unknown degrees of freedom is:
  </p>
  $$
  h = \begin{bmatrix} h_{11} & h_{12} & h_{13} & h_{21} & h_{22} & h_{23} & h_{31} & h_{32} \end{bmatrix}^T
  $$
  <p>From above, the system for a single point correspondence is:</p>
  $$
  \begin{bmatrix}
  x & y & 1 & 0 & 0 & 0 & -xx' & -yx' \\
  0 & 0 & 0 & x & y & 1 & -xy' & -yy'
  \end{bmatrix}
  \begin{bmatrix}
  h_{11} \\ h_{12} \\ h_{13} \\ h_{21} \\ h_{22} \\ h_{23} \\ h_{31} \\ h_{32}
  \end{bmatrix}
  =
  \begin{bmatrix}
  x' \\ y'
  \end{bmatrix}
  $$
  <p>
    We can then stack these rows in the left matrix for additional point correspondences. When this uses more than four point correspondences, we can solve the resulting overdetermined system with least squares to find the best fitting homography.
  </p>
    <hr class="custom">
  <p>
        As an example for set 3, I defined my point correspondences as such (shown with a line between corresponding point) resulting in the $H$ matrix:
    </p>
    <br>
    $$
      H = \begin{bmatrix} 2.069 & 0.011 & −647.7 \\ 0.361 & 1.717 & −190.3 \\ 0.001 & -0.00002 & 1.0 \end{bmatrix}
    $$

    <img src="./images/set3/point_correspondences.jpg" alt="Wurster Stairs Points" style="max-width: 100%; align-self: center;">
</div>
<br>
<div class="base_page">
  <h3>A.3: Warp the images</h3>
    <p>
        For this section we actuall implemented our two warping functions as: 
    </p>
    <pre><code class="language-javascript">imwarped_nn = warpImageNearestNeighbor(im,H)
imwarped_bil = warpImageBilinear(im,H)</code></pre>

    <p>
        To prove the validity of the implementations, we can rectify example images. <br><br>The below comparisons show the original image, the $H$ matrix, and the result using both functions. Finally, there is a pixel-wise comparison noting any differences. I chose not to crop in the images to show warping around the target.
    </p>
        <img src="./images/rectify/square3_rectification_visualization.jpg" alt="Rec3" style="max-width: 100%; align-self: center;">
            <hr class="custom">
        <img src="./images/rectify/square2_rectification_visualization.jpg" alt="Rec1" style="max-width: 100%; align-self: center;">
    <p>
        Interestingly, my bilinear implementation ran faster, despite being more complex. I believe this could be due to multiple image array accesses which take longer than value calculations on my personal machine. The bilinear warp seems slightly blurrier than the neighrest neighbor, which aligns with the idea of averaging neighbors.
        <br><br>I should note for the purpose of this assignment I calculate output size based on the average width and height of the quadrilateral defined by the four points as it may not be an exact square.
        <br><br>Most of the pixel differences are around changes in color/edges in the image, which the bilinear would blur slightly. 
    </p>
</div>

<br>

<div class="base_page">
  <h3>A.4: Blend the Images into a Mosaic</h3>
  <p>
    In this section we actually create our mosaics. 
    <br><br>I chose the one shot procedure, where, per the spec, I first determined the size of final mosaic and then warp all the images into that size using the homographies computed relative to the center image. 
    <br><br>For blurring, I found the overlapping region of the two images and calculated used the distance transform <b>scipy.ndimagedistance_transform_edt</b> to find the distance of each pixel to the nearest zero pixel (non-overlapping region). I then used these distances to weight the pixels in the overlapping region, with closer pixels having a higher weight. I then binarized this with a threshold of 0.5 to create a hard seam, which I passed into the pyramid blending functions we implemented in project 2. My results are as such:
  </p>

  <h4>Set 1: Music Library View</h4>
    <div class="item-row" style="align-self: center; justify-content: center; border-bottom: 0px; margin-bottom: -5px;">
          <div class="image-col">
            <img src="./images/set1/L1.jpg" alt="Music Library 1">
          </div>
          <div class="image-col">
            <img src="./images/set1/L2.jpg" alt="Music Library 2">
          </div>
    </div>
    <img src="./images/set1/mosaic_image_bilinear.png" alt="Music Library 2" style="scale: 80%; max-width: 100%; align-self: center;">
    <hr class="custom">

    <h4>Set 2: Wurster Hall</h4>
    <div class="item-row" style="align-self: center; justify-content: center; border-bottom: 0px; margin-bottom: -5px;">
          <div class="image-col">
            <img src="./images/set2/R1.jpg" alt="Music Library 1">
          </div>
          <div class="image-col">
            <img src="./images/set2/R2.jpg" alt="Music Library 2">
          </div>
    </div>
    <img src="./images/set2/mosaic_image_bilinear.png" alt="Music Library 2" style="scale: 80%; max-width: 100%; align-self: center;">
    <hr class="custom">

    <h4>Set 3: Wurster Stairs</h4>
    <div class="item-row" style="align-self: center; justify-content: center; border-bottom: 0px; margin-bottom: -5px;">
          <div class="image-col">
            <img src="./images/set3/L1.jpg" alt="Music Library 1">
          </div>
          <div class="image-col">
            <img src="./images/set3/L2.jpg" alt="Music Library 2">
          </div>
    </div>
    <img src="./images/set3/mosaic_image_bilinear.png" alt="Music Library 2" style="scale: 80%; max-width: 100%; align-self: center;">
    <hr class="custom">

  </div>

<br>
<a href="../home.html">&larr; Back to Home</a>
</body>
</html>